<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>NextNEXRAD</title>  
        <link rel="shortcut icon" href="//uiowa.edu/profiles/custom/sitenow/assets/favicon.ico">
        <link rel="stylesheet" href="styles.css">
        <link rel="stylesheet" href="sidebar.css">
        <link rel="stylesheet" href="sidebar-window.css">
        <link rel="stylesheet" href="toggle-switch.css">
        <link rel="stylesheet" href="slider.css">
        <link rel="stylesheet" href="drag.css">
        <link rel="stylesheet" href="podLegend.css">
        <link rel="stylesheet" href="marker-control.css">
        <link rel="stylesheet" href="error-modal.css">
        <link rel="stylesheet" href="buttons.css">
        <link rel="stylesheet" href="radioSelector.css">
        <link rel="stylesheet" href="report.css">
        <link rel="stylesheet" href="search.css">
        <link rel="stylesheet" href="TerrainProfile/graph.css">

        <!-- Google Pie Chart -->
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

        <!-- Proj4js for reprojection -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.1/proj4.js"></script>

        <!-- GeographicLib -->
        <!--<script src="https://cdn.jsdelivr.net/npm/geographiclib-geodesic@2.1.1/geographiclib-geodesic.min.js"></script>-->

        <!-- fflate to read gzip files -->
        <script src="https://unpkg.com/fflate/umd/index.js"></script>

        <!-- PBF -->
        <script src="https://unpkg.com/pbf@3.0.5/dist/pbf.js"></script>
        <script src="https://unpkg.com/geobuf@3.0.1/dist/geobuf.js"></script>
        <script src="https://unpkg.com/geobuf@3.0.2/dist/geobuf-dev.js"></script>

        <!-- noUiSlider -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.css">
        <script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.js"></script>
        <link rel="stylesheet" href="noUiSlider.css">

        <!-- plotly -->
        <!--<script src="https://cdn.plot.ly/plotly-2.31.1.js" charset="utf-8"></script>-->
        
        <!-- Google Maps API -->
        <script
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTYZ2ogy4XY8GmiIpiw89OpE9iRk5MnxM&libraries=marker,places,visualization,geometry">
        </script>
    </head>
    <body>
        <div id="map"></div>
        <canvas id="pop-canvas" width="1372" height="740"></canvas>
        <canvas id="coverage-canvas"></canvas>

        <div class="sidebar">
            <div class="sidebar-icon radar" onclick="toggleWindow('radar-settings')" data-target="radar-settings"></div>
            <div class="sidebar-icon add-radar" onclick="toggleWindow('arbitrary-radar')" data-target="arbitrary-radar"></div>
            <div class="sidebar-icon cloud" onclick="toggleWindow('pod-settings')" data-target="pod-settings"></div>
            <div class="sidebar-icon control" onclick="toggleWindow('map-control')" data-target="map-control"></div>
            <div class="sidebar-icon link" id="share-link"></div>
            <div class="sidebar-icon reset" onclick="reset()"></div>
            <!-- <div class="sidebar-icon info" onclick="toggleWindow('information')" data-target="information"></div> -->
        </div>

        <div id="radar-settings" class="sidebar-window">
            <div class="window-title-container">
                <span class="window-title">NEXRAD Coverage</span>
                <span class="window-exit" id="radar-settings-window-exit-btn" onclick="closeWindow(this);">&times;</span>
            </div>
            <div class="window-items-container">
                <div class="settings-label">AGL Threshold (m):</div>
                <div class="settings-input">
                    <input id="threshold-range-slider" class="styled-range-slider" type="range" min="0" max="2" value="0"/>
                    <div class="tick-labels">
                        <span>1,000</span>
                        <span>&nbsp;2,000</span>
                        <span>3,000</span>
                    </div>
                </div>
                <div class="settings-label">Show/Hide</div>
                <div class="settings-input">
                    <label class="switch round">
                        <input type="checkbox" id="show-all-coverage-checkbox"><span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>
        
        <div id="arbitrary-radar" class="sidebar-window">
            <div class="window-title-container">
                <span class="window-title">Build a Radar</span>
                <span class="window-exit" onclick="closeWindow(this);" id="arbitrary-radar-create-close-btn">&times;</span>
            </div>
            <div class="window-items-container">
                <div class="settings-label">
                    Click on map to select location:
                </div>
                <div class="settings-input">
                    <span id="radarLat">Latitude</span>
                    <span>,&nbsp;&nbsp;</span>
                    <span id="radarLng">Longitude</span>
                </div>

                <div class="settings-label">
                    Tower Height (m):
                </div>
                <div class="settings-input">
                    <input type="number" id="towerHeight-input" min="0">
                </div>

                <div class="settings-label">
                    AGL Threshold (m):
                </div>
                <div class="settings-input">
                    <input type="number" id="aglThreshold-input" min="0">
                </div>

                <div class="settings-label">
                    Antenna Elevation Angle(s):
                </div>
                <div class="settings-input double-slider">
                    <div id="elevation-angles-slider"></div>
                </div>
            </div>
            <div class="submit-container">
                <span class="submit-btn" id="radar-submit-btn">Get Coverage</span>
            </div>
        </div>

        <div id="arbitrary-radar-show" class="sidebar-window">
            <div class="window-title-container">
                <span class="window-title">Custom Radar Info</span>
                <span class="window-exit" onclick="this.parentElement.parentElement.style.display = 'none'" id="arbitrary-radar-show-close-btn">&times;</span>
            </div>

            <div class="window-items-container">
                <span class="settings-label">Site ID:</span>
                <div class="settings-input">
                    <span id="dynamic-radar-site-id"></span>
                </div>

                <div class="settings-label">
                    Location:
                </div>
                <div class="settings-input">
                    <span id="dynamic-radar-site-lat">Latitude</span>
                    <span>,&nbsp;&nbsp;</span>
                    <span id="dynamic-radar-site-lng">Longitude</span>
                </div>

                <div class="settings-label">
                    Tower Height (m):
                </div>
                <div class="settings-input">
                    <input type="number" id="dynamic-radar-site-tower-height">
                </div>

                <div class="settings-label">
                    AGL Threshold (m):
                </div>
                <div class="settings-input">
                    <input type="number" id="dynamic-radar-site-max-alt">
                </div>

                <div class="settings-label">
                    Antenna Elevation Angle(s):
                </div>
                <div class="settings-input">
                    <div class="settings-input double-slider">
                        <div id="arbitrary-radar-show-elevation-angles-slider"></div>
                    </div>
                </div>

                <span class="settings-label">Range Rings (km)</span>
                <div class="settings-input">
                    <input type="range" class="styled-range-slider" id="dynamic-radar-range-slider" min="0" max="5" value="0" step="1">
                    <div class="range-slider-labels">
                        <span>None</span>
                        <span>50</span>
                        <span>100</span>
                        <span>150</span>
                        <span>200</span>
                        <span>230</span>
                    </div>
                </div>
            </div>
            <div class="submit-container">
                <span class="submit-btn" style="background: #78cdd7;" id="toggle-dynamic-radar">Toggle</span>
                <span class="submit-btn" id="update-dynamic-radar">Update</span>
                <span class="danger-btn" id="delete-dynamic-radar">Delete</span>
            </div>
        </div>

        
        <div id="existing-radar-show" class="sidebar-window">
            <div class="window-title-container">
                <span class="window-title">NEXRAD Radar Info</span>
                <span class="window-exit" id="existing-radar-show-close-btn">&times;</span>
            </div>
            <div class="window-items-container">
                <div class="settings-label">
                    Site ID:
                </div>
                <div class="settings-input">
                    <span id="existing-radar-site-id"></span>
                </div>

                <div class="settings-label">
                    Location:
                </div>
                <div class="settings-input">
                    <span id="existing-radar-site-lat">Latitude</span>
                    <span>,&nbsp;&nbsp;</span>
                    <span id="existing-radar-site-lng">Longitude</span>
                </div>

                <div class="settings-label">
                    Tower Height (m):
                </div>
                <div class="settings-input">
                    <input type="number" id="existing-radar-site-tower-height"></input>
                </div>

                <div class="settings-label">
                    AGL Threshold (m):
                </div>
                <div class="settings-input">
                    <input type="number" id="existing-radar-site-max-alt"></input>
                </div>

                <div class="settings-label">
                    Antenna Elevation Angle(s):
                </div>
                <div class="settings-input">
                    <div class="settings-input double-slider">
                        <div id="existing-radar-show-elevation-angles-slider"></div>
                    </div>
                </div>

                <span class="settings-label">Range Rings (km)</span>
                <div class="settings-input">
                    <input type="range" class="styled-range-slider" id="existing-radar-range-slider" min="0" max="5" value="0" step="1">
                    <div class="range-slider-labels">
                        <span>None</span>
                        <span>50</span>
                        <span>100</span>
                        <span>150</span>
                        <span>200</span>
                        <span>230</span>
                    </div>
                </div>
            </div>

            <div class="submit-container">
                <span class="submit-btn" id="update-existing-radar">Update</span>
            </div>
        </div>

        <div id="map-control" class="sidebar-window">
            <div class="window-title-container">
                <span class="window-title">Map Controls</span>
                <span class="window-exit" onclick="closeWindow(this);">&times;</span>
            </div>
            <div class="window-items-container">
                <div class="settings-label">NEXRAD Radars</div>
                <div class="edit-marker-container">
                    <div class="settings-input" style="flex: 1;">
                        <label class="switch round">
                            <input type="checkbox" id="existingRadarSites-checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div>
                        <span class="edit-marker-icon" data-marker-type="nexrad"></span>
                    </div>
                </div>

                <div class="settings-label">Generated Radars</div>
                <div class="edit-marker-container">
                    <div class="settings-input" style="flex: 1;">
                        <label class="switch round">
                            <input type="checkbox" id="generatedRadarSites-checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div>
                        <span class="edit-marker-icon" data-marker-type="generated"></span>
                    </div>
                </div>

                <div class="settings-label">USGS Stream Gages</div>
                <div class="edit-marker-container">
                    <div class="settings-input" style="flex: 1;">
                        <label class="switch round">
                            <input type="checkbox" id="usgsSites-checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div>
                        <span class="edit-marker-icon" data-marker-type="usgs"></span>
                    </div>
                </div>

                <div class="settings-label">River Network</div>
                <div class="edit-marker-container">
                    <div class="settings-input" style="flex: 1;">
                        <label class="switch round">
                            <input type="checkbox" id="riverNetwork-checkbox"><span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div>
                        <span class="edit-marker-icon" data-marker-type="river"></span>
                    </div>
                </div>

                <div class="settings-label">Shaded Relief</div>
                <div class="edit-marker-container">
                    <div class="settings-input" style="flex: 0.8;">
                        <label class="switch round">
                            <input type="checkbox" id="terrainOverlay-checkbox"><span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="pop-settings-container">
                    <div class="settings-label">Population Threshold</div>
                    <div class="settings-input">
                        <input type="range" class="styled-range-slider" id="popThreshold-slider" min="1" max="85" value="1" step="1"><br>
                        <span id="popThreshold-value">1 people / 25 km²</span>
                    </div>
                    <div id="population-layer-controls-container">
                        <span class="edit-marker-icon" data-marker-type="population"></span>
                        <span id="clear-pop-layer"></span>
                    </div>
                </div>
            </div>

            <div class="window-items-container">
                <div class="settings-label">Overlay Color</div>
                <div class="settings-input">
                    <span class="color-option" data-color="green" style="background-color: rgb(82, 182, 82);"></span>
                    <span class="color-option" data-color="purple" style="background-color: rgb(82, 82, 182);"></span>
                    <span class="color-option" data-color="gray" style="background-color: rgb(172, 172, 172);"></span>
                    <span class="color-option" data-color="yellow" style="background-color: rgb(255, 222, 32);"></span>
                </div>

                <div class="settings-label">Units</div>
                <div class="settings-input">
                    <span class="unit-option" data-unit="metric">Metric</span>
                    <span class="unit-option" data-unit="imperial">Imperial</span>
                </div>
            </div>
        </div>

        <div class="marker-control-popup">
            <div class="x-btn" onclick="this.parentElement.style.display='none'">×</div>

            <div class="marker-preview" id="marker-preview">
                <span class="color-square" id="preview-square"></span>
                Marker Controls
            </div>

            <div class="control-row">
                <label for="marker-fill">Color</label>
                <input type="color" value="#ff0000" id="marker-fill" onchange="updateMarker()">
            </div>

            <div class="control-row">
                <label for="marker-size" id="marker-size-label">Base Size</label>
                <input type="number" value="4" max="12" min="2.5" step="0.5" id="marker-size" onchange="updateMarker()">
            </div>

            <div class="control-row" id="opacity-control-row" style="display: none;">
                <label for="marker-opacity">Opacity</label>
                <input type="range" class="styled-range-slider" min="0" max="1" step="0.1" value="0.5" id="marker-opacity" onchange="updateMarker()">
                <span id="opacity-value">50%</span>
            </div>
        </div>

        <div id="pod-settings" class="sidebar-window">
            <div class="window-title-container">
                <span class="window-title">Probability of Rain</span>
                <span class="window-exit" id="pod-settings-window-exit-btn" onclick="closeWindow(this);">&times;</span>
            </div>

            <div class="window-items-container">
                <div class="settings-label">Year:</div>
                <div class="settings-input">
                    <select id="pod-year-select" multiple required>
                        <option value="2017">2017</option>
                        <option value="2018">2018</option>
                        <option value="2019">2019</option>
                        <option value="2020">2020</option>
                        <option value="2021">2021</option>
                        <option value="2022">2022</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                    </select>
                </div>

                <div class="settings-label">Selected years:</div>
                <div class="selected-years">
                    <div class="settings-input" id="selected-years-display">No years selected</div>
                </div>

                <span class="settings-label">Season:</span>
                <div id="pod-season-select" class="settings-input">
                    <select id="pod-season-select">
                        <option value="">All</option>
                        <option value="Winter">Winter</option>
                        <option value="Spring">Spring</option>
                        <option value="Summer">Summer</option>
                        <option value="Fall">Fall</option>
                    </select>
                </div>

                <span class="settings-label">Number of Colors:</span>
                <div class="settings-input">
                    <input type="number" id="pod-color-count" min="2" max="64" value="32">
                </div>

                <span class="settings-label">Value Range - Min/Max</span>
                <div class="settings-input double-slider">
                    <div id="pod-range-slider"></div>
                </div>

                <span class="settings-label">Color Palette</span>
                <div class="pod-color-palette">
                    <span class="radio-selector selected" data-value="Spectral">Spectral</span>
                    <span class="radio-selector" data-value="Blues">Blues</span>
                    <span class="radio-selector" data-value="Red-Blue">Red-Blue</span>
                    <span class="radio-selector" data-value="Red-Gray">Red-Gray</span>
                </div>

                <span class="settings-label">Opacity</span>
                <div class="settings-input" style="position: relative; margin-top: 8px;">
                    <div><span id="pod-opacity-value">100</span></div>
                    <input type="range" class="styled-range-slider" id="pod-opacity" min="0" max="100" value="100">
                </div>
            </div>
            <div class="submit-container">
                <span class="submit-btn" id="submit-pod-layer">Submit</span>
                <span class="danger-btn" id="clear-pod-layer">Clear</span>
            </div>
        </div>

        <div id="pod-legend-window">
            <div id="pod-legend-container">
                <!-- IMG -->
            </div>
            <div id="pod-legend-label-container">
                <!-- Dynamic tick labels -->
            </div>
        </div>

        <div id="top-bar-container">
            <div id="report-toggle-container">
                <div class="center-content">
                    <span id="report-menu-title">Basin Statistics</span>
                    <img class="drop-down-icon" src="https://maps.gstatic.com/mapfiles/arrow-down.png">
                </div>
                <span id="basin-stats-window-close" style="display: none;">&times;</span>
            </div>

            <div id="search-container">
                <div id="search-input-container">
                    <input type="text" id="search-input" placeholder="Search ...">
                    <img id="search-icon" src="public/icons/search.png">
                </div>
                <ul id="search-results">
                </ul>
            </div>

            <div id="toggle-terrain-profile-container">
                <span>Terrain Profile</span>
                <label class="switch round">
                    <input type="checkbox" id="terrain-profile-mode-toggle">
                    <span class="toggle-slider"></span>
                </label>    
            </div>
        </div>

        <div id="basin-info-container">
            <div id="basin-title-container">
                <span id="basin-title"></span>
            </div>
            <div class="stats-container">
                <div class="legend-items-container" id="area-legend"></div>
                <div class="chart-container">
                    <span class="basin-subtitle" id="area-heading"><sup>2</sup></span>
                    <canvas class="piechart" id="area-piechart" width="120" height="120"></canvas>
                </div>
            </div>
            <div class="stats-container">
                <div class="legend-items-container" id="population-legend"></div>
                <div class="chart-container">
                    <span class="basin-subtitle" id="population-heading"></span>
                    <canvas class="piechart" id="population-piechart" width="120" height="120"></canvas>
                </div>
            </div>
        </div>

        <!-- Terrain Profile Graph -->
        <div id="terrainProfileCanvasContainer" style="display: none;">
            <div id="terrainProfileTitleContainer">
                <span id="terrainProfileTitle">Azimuth: 0°</span>
                <span id="profileWindowExit">&times;</span>
            </div>
            <canvas id="terrainProfileCanvas" height="400" width="920"></canvas>
        </div>

        <!-- Error Modal -->
        <div id="error-overlay">
            <div id="error-modal">
                <div id="error-message"></div>
                <span id="error-close">Close</span>
            </div>
        </div>


        <!-- Loading spinner, shown after request is sent and before coverage loads on map -->
         <div id="loading-spinner" style="display: none;">
            <div class="spinner"></div>
        </div>

        <script src="markerCollection.js"></script>
        <script src="infoTool.js"></script>
        <script src="dynaImg.js"></script>
        <script src="customOverlay.js"></script>
        <script src="canvasOverlay.js"></script>
        <script src="public/config.js"></script>
        <script src="constants.js"></script>
        <script src="elevationAnglesSlider.js"></script>
        <script src="RadarFieldsManager.js"></script>
        <script src="rangeRings.js"></script>
        <script src="radarLayer.js"></script>
        <script src="MapLocationSelector.js"></script>
        <script src="radarController.js"></script>
        <script src="usgsLayer.js"></script>
        <script src="podLayer.js"></script>
        <script src="populationLayer.js"></script>
        <script src="coveragesLayer.js"></script>
        <script src="markerTip.js"></script>
        <script src="pbfLayer.js"></script>
        <script src="riverNetworkHelper.js"></script>
        <script src="riverNetworkLayer.js"></script>
        <script src="draggable.js"></script>
        <script src="podLegend.js"></script>
        <script src="settings.js"></script>
        <script src="markerControl.js"></script>
        <script src="terrainOverlay.js"></script>
        <script src="errorModal.js"></script>
        <script src="windowObserver.js"></script>
        <script src="oneWaySlider.js"></script>
        <script src="reporter.js"></script>
        <script src="map.js"></script>
        <script src="search.js"></script>
        <script src="TerrainProfile/profileSelector.js"></script>
        <script src="TerrainProfile/profileViewer.js"></script>
        <script src="TerrainProfile/getTerrainProfile.js"></script>
        <script src="TerrainProfile/displayTerrainProfile.js"></script>
        <script src="TerrainProfile/beamModel.js"></script>
        <script>
            window.onload = function () {
                initMap();
            }
        </script>
      </body>
</html>